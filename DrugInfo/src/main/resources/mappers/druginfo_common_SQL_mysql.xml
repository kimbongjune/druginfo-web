<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
    <resultMap id="DruginfoVO" type="DruginfoVO">
    	<result property="id" column="ID" />
        <result property="entpName" column="ENTP_NAME" />
        <result property="itemName" column="ITEM_NAME" />
        <result property="itemSeq" column="ITEM_SEQ" />
        <result property="efcyQesitm" column="EFCY_QESITM" />
        <result property="useMethodQesitm" column="USE_METHOD_QESITM" />
        <result property="atpnWarnQesitm" column="ATPN_WARN_QUSITM" />
        <result property="atpnQesitm" column="ATPN_QESITM" />
        <result property="intrcQesitm" column="INTRC_QUSITM" />
        <result property="seQesitm" column="SE_QESITM" />
        <result property="depositMethodQesitm" column="DEPOSIT_METHOD_QESITM" />
        <result property="openDe" column="OPEN_DE" />
        <result property="updateDe" column="UPDATE_DE" />
        <result property="itemImage" column="ITEM_IMAGE" />
        <result property="total" column="total" />
        <result property="page" column="page" />
        <collection property="drugDetailInfoVO" resultMap="DrugDetailInfoVO"></collection>
        <collection property="pillInfoVO" resultMap="PillInfoVO"></collection>
    </resultMap>
    
   <select id="selectDrugInfoListAll" parameterType="DruginfoVO" resultMap="DruginfoVO" >
        SELECT
            ID, ENTP_NAME, ITEM_NAME, ITEM_SEQ, EFCY_QESITM, USE_METHOD_QESITM, ATPN_WARN_QUSITM, ATPN_QESITM, INTRC_QUSITM, SE_QESITM, DEPOSIT_METHOD_QESITM, OPEN_DE, UPDATE_DE, ITEM_IMAGE
        FROM
            drbeasydruglist
    </select>
    
    <insert id="insertDrugInfoOne" parameterType="DruginfoVO">
    	insert into drbeasydruglist
		(
			ENTP_NAME, 
			ITEM_NAME, 
			ITEM_SEQ, 
			EFCY_QESITM, 
			USE_METHOD_QESITM, 
			ATPN_WARN_QUSITM, 
			ATPN_QESITM, 
			INTRC_QUSITM, 
			SE_QESITM, 
			DEPOSIT_METHOD_QESITM, 
			OPEN_DE, 
			UPDATE_DE, 
			ITEM_IMAGE
		) values
		(
			#{entpName},
			#{itemName},
			#{itemSeq},
			#{efcyQesitm},
			#{useMethodQesitm},
			#{atpnWarnQesitm},
			#{atpnQesitm},
			#{intrcQesitm},
			#{seQesitm},
			#{depositMethodQesitm},
			#{openDe},
			#{updateDe},
			#{itemImage}
		)
    </insert>
    <insert id="insertDrugInfoList" parameterType="java.util.List">
    	insert into drbeasydruglist
		(
			ENTP_NAME, 
			ITEM_NAME, 
			ITEM_SEQ, 
			EFCY_QESITM, 
			USE_METHOD_QESITM, 
			ATPN_WARN_QUSITM, 
			ATPN_QESITM, 
			INTRC_QUSITM, 
			SE_QESITM, 
			DEPOSIT_METHOD_QESITM, 
			OPEN_DE, 
			UPDATE_DE, 
			ITEM_IMAGE
		) values
			<foreach collection="list" item="item" separator=",">
				(
					#{item.entpName},
					#{item.itemName},
					#{item.itemSeq},
					#{item.efcyQesitm},
					#{item.useMethodQesitm},
					#{item.atpnWarnQesitm},
					#{item.atpnQesitm},
					#{item.intrcQesitm},
					#{item.seQesitm},
					#{item.depositMethodQesitm},
					#{item.openDe},
					#{item.updateDe},
					#{item.itemImage}
				)
	        </foreach>
    </insert>
       <select id="selectDrugInfoSearchList" parameterType="DruginfoVO" resultMap="DruginfoVO" >
        SELECT 
        	a.ID, a.ENTP_NAME, a.ITEM_NAME, a.ITEM_SEQ, a.EFCY_QESITM, a.USE_METHOD_QESITM,b.ITEM_IMAGE, b.CLASS_NAME, 
            c.WARNING_TEXT, c.NO_INJECT, c.CAUTION_INJECT, c.ALLERGY_REACTION, c.GENERAL_CAUTION, c.MULTIE_INJECT_WARNING, c.PREGNANT_WOMEN_INJECT_WARNING,
			c.LACTIATION_WOMEN_INJECT_WARNING, c.CHILD_INJECT_WARNING, c.OLDMAN_INJECT_WARNING, c.PREGNANT_WOMEN_WITH_LACTIATION_WOMEN_WARNING, c.OVERDOSE_TREATMENT, c.DOSE_CAUTION,
			c.BEFORE_CONSULT_DOCTOR, c.AFTER_CONSULT_DOCTOR, c.INTERACTION_CAUTION, c.EXTRA_CAUTION, c.STORAGE_METHOD, c.VALID_TERM, c.EDI_CODE 
		FROM 
			drbeasydruglist as a
		LEFT JOIN 
			mdcingrnidntfcinfolist as b 
		ON a.ITEM_SEQ = b.ITEM_SEQ
		LEFT JOIN 
			drugprdtprmsndtlinq as c 
		ON a.ITEM_SEQ = c.ITEM_SEQ
			<where>
				<if test="itemName != null and itemName != ''">
					AND a.ITEM_NAME like concat('%',#{itemName},'%') or a.ENTP_NAME like concat('%',#{itemName},'%') or a.EFCY_QESITM like concat('%',#{itemName},'%')
				</if>
				<if test="pillInfoVO.DRUG_SHAPE != null and pillInfoVO.DRUG_SHAPE != ''">
					AND b.DRUG_SHAPE like concat('%',#{pillInfoVO.DRUG_SHAPE},'%')
				</if>
				<if test="pillInfoVO.PRINT_FRONT != null and pillInfoVO.PRINT_FRONT != ''">
					AND b.PRINT_FRONT like concat('%',#{pillInfoVO.PRINT_FRONT},'%')
				</if>
				<if test="pillInfoVO.PRINT_BACK != null and pillInfoVO.PRINT_BACK != ''">
					AND b.PRINT_BACK like concat('%',#{pillInfoVO.PRINT_BACK},'%')
				</if>
				<if test="pillInfoVO.FORM_CODE_NAME != null and pillInfoVO.FORM_CODE_NAME != ''">
					AND b.FORM_CODE_NAME like concat('%',#{pillInfoVO.FORM_CODE_NAME},'%')
				</if>
				<if test="pillInfoVO.COLOR_CLASS1 != null and pillInfoVO.COLOR_CLASS1 != ''">
					AND (b.COLOR_CLASS1 like concat('%',#{pillInfoVO.COLOR_CLASS1},'%')
					OR b.COLOR_CLASS2 like concat('%',#{pillInfoVO.COLOR_CLASS1},'%'))
				</if>
				<if test="pillInfoVO.LINE_FRONT != null and pillInfoVO.LINE_FRONT != ''">
					AND (b.LINE_FRONT like concat('%',#{pillInfoVO.LINE_FRONT},'%')
					OR b.LINE_BACK like concat('%',#{pillInfoVO.LINE_FRONT},'%'))
				</if>
			</where>
			<choose>
				<when test="page != null and page != ''">
					ORDER BY a.ITEM_NAME LIMIT ${page}, 15
				</when>
				<otherwise>
					ORDER BY a.ITEM_NAME LIMIT 0, 15
				</otherwise>
			</choose>
    	</select>
  	   <select id="selectDrugInfoSearchListCnt" parameterType="DruginfoVO" resultType="int" >
	        select count(*) from drbeasydruglist as a
			left join mdcingrnidntfcinfolist as b 
				on a.ITEM_SEQ = b.ITEM_SEQ
			left join drugprdtprmsndtlinq as c 
				on a.ITEM_SEQ = c.ITEM_SEQ
			<where>
				<if test="itemName != null and itemName != ''">
					AND a.ITEM_NAME like concat('%',#{itemName},'%') or a.ENTP_NAME like concat('%',#{itemName},'%') or a.EFCY_QESITM like concat('%',#{itemName},'%')
				</if>
				<if test="pillInfoVO.DRUG_SHAPE != null and pillInfoVO.DRUG_SHAPE != ''">
					AND b.DRUG_SHAPE like concat('%',#{pillInfoVO.DRUG_SHAPE},'%')
				</if>
				<if test="pillInfoVO.PRINT_FRONT != null and pillInfoVO.PRINT_FRONT != ''">
					AND b.PRINT_FRONT like concat('%',#{pillInfoVO.PRINT_FRONT},'%')
				</if>
				<if test="pillInfoVO.PRINT_BACK != null and pillInfoVO.PRINT_BACK != ''">
					AND b.PRINT_BACK like concat('%',#{pillInfoVO.PRINT_BACK},'%')
				</if>
				<if test="pillInfoVO.FORM_CODE_NAME != null and pillInfoVO.FORM_CODE_NAME != ''">
					AND b.FORM_CODE_NAME like concat('%',#{pillInfoVO.FORM_CODE_NAME},'%')
				</if>
				<if test="pillInfoVO.COLOR_CLASS1 != null and pillInfoVO.COLOR_CLASS1 != ''">
					AND (b.COLOR_CLASS1 like concat('%',#{pillInfoVO.COLOR_CLASS1},'%')
					OR b.COLOR_CLASS2 like concat('%',#{pillInfoVO.COLOR_CLASS1},'%'))
				</if>
				<if test="pillInfoVO.LINE_FRONT != null and pillInfoVO.LINE_FRONT != ''">
					AND (b.LINE_FRONT like concat('%',#{pillInfoVO.LINE_FRONT},'%')
					OR b.LINE_BACK like concat('%',#{pillInfoVO.LINE_FRONT},'%'))
				</if>
			</where>
    	</select>
</mapper>