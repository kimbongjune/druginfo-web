<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
    <resultMap id="DruginfoVO" type="DruginfoVO">
    	<result property="id" column="id" />
        <result property="entpName" column="entpName" />
        <result property="itemName" column="itemName" />
        <result property="itemSeq" column="itemSeq" />
        <result property="efcyQesitm" column="efcyQesitm" />
        <result property="useMethodQesitm" column="useMethodQesitm" />
        <result property="atpnWarnQesitm" column="atpnWarnQesitm" />
        <result property="atpnQesitm" column="atpnQesitm" />
        <result property="intrcQesitm" column="intrcQesitm" />
        <result property="seQesitm" column="seQesitm" />
        <result property="depositMethodQesitm" column="depositMethodQesitm" />
        <result property="openDe" column="openDe" />
        <result property="updateDe" column="updateDe" />
        <result property="itemImage" column="itemImage" />
        <result property="total" column="total" />
        <result property="page" column="page" />
        <collection property="drugDetailInfoVO" resultMap="DrugDetailInfoVO"></collection>
        <collection property="pillInfoVO" resultMap="PillInfoVO"></collection>
    </resultMap>
    
   <select id="selectDrugInfoListAll" parameterType="DruginfoVO" resultMap="DruginfoVO" >
        SELECT
            id, entpName, itemName, itemSeq, efcyQesitm, useMethodQesitm, atpnWarnQesitm, atpnQesitm, intrcQesitm, seQesitm, depositMethodQesitm, openDe, updateDe, itemImage
        FROM
            drbeasydruglist
    </select>
    
    <insert id="insertDrugInfoOne" parameterType="DruginfoVO">
    	insert into drbeasydruglist
		(
			entpName, 
			itemName, 
			itemSeq, 
			efcyQesitm, 
			useMethodQesitm, 
			atpnWarnQesitm, 
			atpnQesitm, 
			intrcQesitm, 
			seQesitm, 
			depositMethodQesitm, 
			openDe, 
			updateDe, 
			itemImage
		) values
		(
			#{entpName},
			#{itemName},
			#{itemSeq},
			#{efcyQesitm},
			#{useMethodQesitm},
			#{atpnWarnQesitm},
			#{atpnQesitm},
			#{intrcQesitm},
			#{seQesitm},
			#{depositMethodQesitm},
			#{openDe},
			#{updateDe},
			#{itemImage}
		)
    </insert>
       <select id="selectDrugInfoSearchList" parameterType="DruginfoVO" resultMap="DruginfoVO" >
        SELECT 
        	a.id, a.entpName, a.itemName, a.itemSeq, a.efcyQesitm, a.useMethodQesitm,b.ITEM_IMAGE, b.CLASS_NAME, 
            c.WARNING_TEXT, c.NO_INJECT, c.CAUTION_INJECT, c.ALLERGY_REACTION, c.GENERAL_CAUTION, c.MULTIE_INJECT_WARNING, c.PREGNANT_WOMEN_INJECT_WARNING,
			c.LACTIATION_WOMEN_INJECT_WARNING, c.CHILD_INJECT_WARNING, c.OLDMAN_INJECT_WARNING, c.PREGNANT_WOMEN_WITH_LACTIATION_WOMEN_WARNING, c.OVERDOSE_TREATMENT, c.DOSE_CAUTION,
			c.BEFORE_CONSULT_DOCTOR, c.AFTER_CONSULT_DOCTOR, c.INTERACTION_CAUTION, c.EXTRA_CAUTION, c.STORAGE_METHOD, c.VALID_TERM, c.EDI_CODE 
				from drbeasydruglist as a
			left join mdcingrnidntfcinfolist as b 
				on a.itemSeq = b.ITEM_SEQ
			left join drugprdtprmsndtlinq as c 
				on a.itemSeq = c.ITEM_SEQ
			<where>
				<if test="itemName != null and itemName != ''">
					and a.itemName like concat('%',#{itemName},'%') or a.entpName like concat('%',#{itemName},'%') or a.efcyQesitm like concat('%',#{itemName},'%')
				</if>
			</where>
			<choose>
				<when test="page != null and page != ''">
					order by a.itemName limit ${page}, 15
				</when>
				<otherwise>
					order by a.itemName limit 0, 15
				</otherwise>
			</choose>
    	</select>
  	   <select id="selectDrugInfoSearchListCnt" parameterType="DruginfoVO" resultType="int" >
	        select count(*) from drbeasydruglist as a
			left join mdcingrnidntfcinfolist as b 
				on a.itemSeq = b.ITEM_SEQ
			left join drugprdtprmsndtlinq as c 
				on a.itemSeq = c.ITEM_SEQ
			<where>
				<if test="itemName != null and itemName != ''">
					and a.itemName like concat('%',#{itemName},'%') or a.entpName like concat('%',#{itemName},'%') or a.efcyQesitm like concat('%',#{itemName},'%')
				</if>
			</where>
    	</select>
</mapper>